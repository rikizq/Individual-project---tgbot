```python
import requests
from aiogram import Bot, Dispatcher, types
from aiogram.filters import Command
from aiogram.types import Message
import random
import asyncio

TOKEN = "8205786674:AAF0JYnQBU7F6-hXQ0eqjYoJZyxAFhlxKsA"

bot = Bot(token=TOKEN)
dp = Dispatcher()


# --- –§—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ ---
def search_music(query, limit=5):
    url = "https://itunes.apple.com/search"
    params = {
        "term": query,
        "entity": "song",
        "limit": limit,
        "country": "RU",  # –ò—â–µ–º –≤ –†–æ—Å—Å–∏–∏
        "lang": "ru_ru"
    }
    return requests.get(url, params=params).json().get("results", [])


def search_by_artist(artist, limit=5):
    url = "https://itunes.apple.com/search"
    params = {
        "term": artist,
        "entity": "song",
        "attribute": "artistTerm",
        "limit": limit,
        "country": "RU",
        "lang": "ru_ru"
    }
    return requests.get(url, params=params).json().get("results", [])


def search_by_track(track, limit=5):
    url = "https://itunes.apple.com/search"
    params = {
        "term": track,
        "entity": "song",
        "attribute": "songTerm",
        "limit": limit,
        "country": "RU",
        "lang": "ru_ru"
    }
    return requests.get(url, params=params).json().get("results", [])


def get_top_tracks(limit=5):
    url = f"https://itunes.apple.com/ru/rss/topsongs/limit={limit}/json"
    try:
        results = requests.get(url).json().get("feed", {}).get("entry", [])
        tracks = []
        for t in results:
            tracks.append({
                "trackName": t["im:name"]["label"],
                "artistName": t["im:artist"]["label"],
                "previewUrl": t["link"][0]["attributes"]["href"]
            })
        return tracks
    except Exception as e:
        print(f"Error getting top tracks: {e}")
        # Fallback to international top
        url_us = f"https://itunes.apple.com/us/rss/topsongs/limit={limit}/json"
        results = requests.get(url_us).json().get("feed", {}).get("entry", [])
        tracks = []
        for t in results:
            tracks.append({
                "trackName": t["im:name"]["label"],
                "artistName": t["im:artist"]["label"],
                "previewUrl": t["link"][0]["attributes"]["href"]
            })
        return tracks


def get_random_tracks(limit=5):
    # –ò—â–µ–º –ø–æ —Ä—É—Å—Å–∫–∏–º –±—É–∫–≤–∞–º –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
    search_terms = ["–∞", "–∏", "love", "pop", "rock", "–¥"]
    term = random.choice(search_terms)
    results = search_music(term, limit=50)

    if len(results) < limit:
        # –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –º–∞–ª–æ, –¥–æ–±–∞–≤–ª—è–µ–º –µ—â–µ
        results += search_music(random.choice(["a", "the", "me"]), limit=30)

    return random.sample(results, min(limit, len(results)))


# --- –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ ---
@dp.message(Command('start'))
async def cmd_start(message: Message):
    await message.answer(
        "–ü—Ä–∏–≤–µ—Ç! –Ø –º—É–∑—ã–∫–∞–ª—å–Ω—ã–π –±–æ—Ç üéµ\n\n"
        "–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞ –∏–ª–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è, –∏ —è –Ω–∞–π–¥—É –º—É–∑—ã–∫—É –¥–ª—è —Ç–µ–±—è.\n"
        "–Ø –∏—â—É –∫–∞–∫ —Ä—É—Å—Å–∫–∏–µ, —Ç–∞–∫ –∏ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ –ø–µ—Å–Ω–∏!\n\n"
        "–ò—Å–ø–æ–ª—å–∑—É–π /help —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã."
    )


@dp.message(Command('help'))
async def cmd_help(message: Message):
    await message.answer(
        "–í–æ—Ç —á—Ç–æ —è —É–º–µ—é:\n"
        "/help - –ø–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É\n"
        "/random - –ø–æ–ª—É—á–∏—Ç—å —Å–ª—É—á–∞–π–Ω—ã–µ —Ç—Ä–µ–∫–∏\n"
        "/top - –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ø-–ø–µ—Å–Ω–∏\n"
        "/settings - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞\n"
        "/artist <–∏–º—è> - –ø–æ–∏—Å–∫ —Ç—Ä–µ–∫–æ–≤ –ø–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é\n"
        "/track <–Ω–∞–∑–≤–∞–Ω–∏–µ> - –ø–æ–∏—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç—Ä–µ–∫–∞\n\n"
        "–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞ –∏–ª–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è."
    )


@dp.message(Command('random'))
async def cmd_random(message: Message):
    tracks = get_random_tracks()
    if not tracks:
        await message.answer("–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å–ª—É—á–∞–π–Ω—ã–µ —Ç—Ä–µ–∫–∏ ")
        return

    text = " –°–ª—É—á–∞–π–Ω—ã–µ —Ç—Ä–µ–∫–∏:\n\n"
    for t in tracks:
        text += f"üéµ {t.get('trackName', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}\n"
        text += f"üë§ {t.get('artistName', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}\n"
        if 'previewUrl' in t:
            text += f"üîó {t['previewUrl']}\n"
        text += "\n"
    await message.answer(text[:4000])


@dp.message(Command('top'))
async def cmd_top(message: Message):
    tracks = get_top_tracks(limit=10)
    if not tracks:
        await message.answer("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ç–æ–ø-–ø–µ—Å–Ω–∏ ")
        return

    text = " –¢–æ–ø-–ø–µ—Å–Ω–∏:\n\n"
    for i, t in enumerate(tracks, 1):
        text += f"{i}. üéµ {t.get('trackName', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}\n"
        text += f"   üë§ {t.get('artistName', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}\n"
        if 'previewUrl' in t:
            text += f"   üîó {t['previewUrl']}\n"
        text += "\n"
    await message.answer(text[:4000])


@dp.message(Command('settings'))
async def cmd_settings(message: Message):
    await message.answer(
        "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞:\n\n"
        "‚Ä¢ –°—Ç—Ä–∞–Ω–∞ –ø–æ–∏—Å–∫–∞: –†–æ—Å—Å–∏—è\n"
        "‚Ä¢ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: 5-10\n"
        "‚Ä¢ –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞: –†—É—Å—Å–∫–∏–π\n\n"
        "–ë–æ—Ç –∏—â–µ—Ç –º—É–∑—ã–∫—É –≤ iTunes Store —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞."
    )


# --- –ü–æ–∏—Å–∫ –ø–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é ---
@dp.message(Command('artist'))
async def cmd_artist(message: Message):
    args = message.text.split(maxsplit=1)
    if len(args) < 2:
        await message.answer(" –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏ –∏–º—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã /artist")
        return

    tracks = search_by_artist(args[1], limit=10)
    if not tracks:
        await message.answer(f"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å '{args[1]}' –Ω–µ –Ω–∞–π–¥–µ–Ω ")
        return

    text = f"üé§ –¢—Ä–µ–∫–∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è {args[1]}:\n\n"
    for i, t in enumerate(tracks[:10], 1):
        text += f"{i}. üéµ {t.get('trackName', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}\n"
        if 'previewUrl' in t:
            text += f"   üîó {t['previewUrl']}\n"
        text += "\n"
    await message.answer(text[:4000])


# --- –ü–æ–∏—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç—Ä–µ–∫–∞ ---
@dp.message(Command('track'))
async def cmd_track(message: Message):
    args = message.text.split(maxsplit=1)
    if len(args) < 2:
        await message.answer("‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞ –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã /track")
        return

    tracks = search_by_track(args[1], limit=10)
    if not tracks:
        await message.answer(f"–¢—Ä–µ–∫ '{args[1]}' –Ω–µ –Ω–∞–π–¥–µ–Ω ")
        return

    text = f"üéµ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ —Ç—Ä–µ–∫–∞ '{args[1]}':\n\n"
    for i, t in enumerate(tracks[:10], 1):
        text += f"{i}. üéµ {t.get('trackName', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}\n"
        text += f"   üë§ {t.get('artistName', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}\n"
        if 'previewUrl' in t:
            text += f"   üîó {t['previewUrl']}\n"
        text += "\n"
    await message.answer(text[:4000])


# --- –õ—é–±–æ–π —Ç–µ–∫—Å—Ç (–ø–æ–∏—Å–∫ –ø–æ –æ–±—â–µ–º—É –∑–∞–ø—Ä–æ—Å—É) ---
@dp.message()
async def music_search(message: Message):
    query = message.text.strip()
    if not query:
        return

    tracks = search_music(query, limit=10)

    if not tracks:
        await message.answer(f"–ü–æ –∑–∞–ø—Ä–æ—Å—É '{query}' –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ \n–ü–æ–ø—Ä–æ–±—É–π –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π /help")
        return

    text = f"üé∂ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É '{query}':\n\n"
    for i, t in enumerate(tracks[:10], 1):
        text += f"{i}. üéµ {t.get('trackName', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}\n"
        text += f"   üë§ {t.get('artistName', '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ')}\n"
        if 'previewUrl' in t:
            text += f"   üîó {t['previewUrl']}\n"
        text += "\n"

    await message.answer(text[:4000])


# --- –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ ---
async def main():
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω! –ò—â–µ—Ç –º—É–∑—ã–∫—É...")
    await dp.start_polling(bot)


if __name__ == "__main__":
    asyncio.run(main())
```

### –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

`import requests from aiogram import Bot, Dispatcher, types`

`requests` ‚Äî —á—Ç–æ–±—ã —Å—Ö–æ–¥–∏—Ç—å –Ω–∞ —Å–∞–π—Ç –∏ —Å–ø—Ä–æ—Å–∏—Ç—å –º—É–∑—ã–∫—É
    
`aiogram` ‚Äî —á—Ç–æ–±—ã –±–æ—Ç —É–º–µ–ª —á–∏—Ç–∞—Ç—å –∏ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è
    

---
### –¢–æ–∫–µ–Ω

`TOKEN = "8205786674:AAF0JYnQBU7F6-hXQ0eqjYoJZyxAFhlxKsA"`

–≠—Ç–æ –º–æ–π —Ç–æ–∫–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
Telegram –ø–æ –Ω–µ–º—É –ø–æ–Ω–∏–º–∞–µ—Ç, –∫–∞–∫–æ–π –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç.

---
### –°–æ–∑–¥–∞—ë–º –±–æ—Ç–∞

`bot = Bot(token=TOKEN) dp = Dispatcher()`

`bot` ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

`dp` ‚Äî –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

---

### –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞

`def search_music(query):`

–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è:
–ø–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—Å—Ç (—á—Ç–æ —Ç—ã –Ω–∞–ø–∏—Å–∞–ª)
–∏—â–µ—Ç –º—É–∑—ã–∫—É
–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Å–Ω–∏
    
---
`params = {     "term": query,     "entity": "song",     "limit": 5 }`

–ó–¥–µ—Å—å –º—ã –≥–æ–≤–æ—Ä–∏–º —Å–∞–π—Ç—É:

–∏—Å–∫–∞—Ç—å –ø–æ —ç—Ç–æ–º—É —Ç–µ–∫—Å—Ç—É
    
–∏—Å–∫–∞—Ç—å –∏–º–µ–Ω–Ω–æ –ø–µ—Å–Ω–∏
    
–≤–µ—Ä–Ω—É—Ç—å –Ω–µ –±–æ–ª—å—à–µ 5 —à—Ç—É–∫
    
---

`return requests.get(url, params=params).json()["results"]`

–ü—Ä–æ—â–µ:

 ¬´–°—Ö–æ–¥–∏ –Ω–∞ —Å–∞–π—Ç ‚Üí –≤–æ–∑—å–º–∏ –æ—Ç–≤–µ—Ç ‚Üí –≤–µ—Ä–Ω–∏ –ø–µ—Å–Ω–∏¬ª

---
### –ö–æ–≥–¥–∞ —Ç—ã –ø–∏—à–µ—à—å —Å–æ–æ–±—â–µ–Ω–∏–µ

`@dp.message() async def music(message):`

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:

¬´–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –Ω–∞–ø–∏—à–µ—Ç –±–æ—Ç—É ‚Äî –∑–∞–ø—É—Å–∫–∞–π —ç—Ç–æ—Ç –∫–æ–¥¬ª

---

`tracks = search_music(message.text)`

–ò—â–µ—Ç –ø–æ –Ω–µ–º—É –º—É–∑—ã–∫—É

---
### –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞—à–ª–∏

`if not tracks:     await message.answer("–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üòî")`

–ë–æ—Ç —á–µ—Å—Ç–Ω–æ —Å–∫–∞–∂–µ—Ç, —á—Ç–æ –ø–µ—Å–µ–Ω –Ω–µ—Ç

---

### –ì–æ—Ç–æ–≤–∏–º –æ—Ç–≤–µ—Ç

`text = "üé∂ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:\n\n"`

–°–æ–∑–¥–∞—ë–º —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–∏–º

---

`for t in tracks:`

–ë–µ—Ä—ë–º –∫–∞–∂–¥—É—é –Ω–∞–π–¥–µ–Ω–Ω—É—é –ø–µ—Å–Ω—é

---

`text += (     f"üéµ {t['trackName']}\n"     f"üë§ {t['artistName']}\n"     f"{t['previewUrl']}\n\n" )`

–î–æ–±–∞–≤–ª—è–µ–º:

–Ω–∞–∑–≤–∞–Ω–∏–µ –ø–µ—Å–Ω–∏
    
–∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
    
---
### –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ

`await message.answer(text)`

–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç —Ç–µ–±–µ

---
### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

`dp.run_polling(bot)`

–±–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è